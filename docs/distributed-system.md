# Embedded TSDB

## 分布式基础

#### 分布式归纳，纵横

纵：分布书事务

TCC，Saga，XA

横：分布式系统，包括分布式存储（分布式消息）、分布式计算、分布式调度、分布式网络

#### 如何实现分布式

分布式事务和共识算法都使用状态机

#### 分布式系统的基石，共识算法（复制协议，多数协议）

任何不使用共识算法的分布式系统，都存在单点故障，类型redis中的哨兵模式，大部分系统都将共识部分抽取出来，
使用外部系统来实现，比如注册中心、kafka（旧版本）。

##### 拜占庭问题



##### Raft

raft是否是分区可容忍的？

不，因为raft必须取得大部分节点的投票，才可以成为Leader，同时在分区情况下，有可能出现投票一致情况而发生脑裂，
而raft使用随机时间来避免脑裂的出现，所以raft算法不存在分区情况。

#### 分布式系统的度量指标，CAP理论

##### 一致性

我们讨论分布式系统，通常要达到的目的是实现一致性，而不是系统的完全正确，那是量子纠缠才能达到的地方。

系统完全正确表示只要我对系统发出了指令，那么他一定执行指令并达到状态。

同时一致性分为客户端一致性（对外部一致）和服务端一致性（内部一致）。

一致性级别

强一致性，线性一致性，最终一致性，弱一致性

##### 可用性（性能）

一致性与性能的取舍，大部分分布式存储系统都采用分层，核心meta层和数据层，数据层使用宽松的主副

##### 分区容忍性

网络分区容忍度，如果容忍网络分区，那么网络分区后就形成了两个独立的系统，就会出现不一致情况，所以大部分系统
是不能容忍网络分区的。

在存在网络分区的情况下，分布式系统要么可用，要么一致。

#### 从CAP定理视角看raft

CAP理论是学术理论，但在工业界中，系统更多是调和取舍，像raft协议一样，

他对外部来说他是强一致性，而对内部来说是最终一致性，这里的强一致性可以理解为是对于外部（也就是客户端）而言。
客户端如果能观察到（通过 Get 操作）系统的不一致状态，那么系统就不是强一致的。很明显，对于 Raft 实现的系统，
外部无法察觉到其内部的“不一致”。

那么，有 A（Availability） 吗？貌似 Raft 所支撑的服务也有 A？但好像也有没有 A 的情况：

出现较为严重的故障，导致 Leader 无法就 log 达成一致时
或者，甚至于连 Leader 都无法选举成功时
这时候，对外肯定是无法提供服务的，也就没有了 A

但一个分布式系统中的大多数机器都同时出现问题的可能性，应该是非常小的吧？

再然后，有 P（Partition Tolerance）吗？貌似也是有的？但是好像也不全有？

Raft 实现的系统，可以容忍一定限度内的网络分区，这个限度就是：网络可以分区，但是呢，最大的分区内要有超过半数的服务器

如果不能满足这个条件，那系统立马就变得不可用了。因此，好像容忍了网络的分区，但又没完全容忍~

但跟 A 中的情况一样，这种出问题的情况发生的可能性应该是比较小的~

https://zhuanlan.zhihu.com/p/592143575



